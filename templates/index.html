<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –∫–∞—Ñ–µ –≤ –•–∞—Ä—å–∫–æ–≤–µ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <style>
        #map {
            height: 600px;
            position: relative;
        }

        /* –ö–Ω–æ–ø–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è */
        .custom-controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 1000;
        }

        .custom-controls button {
            width: 40px;
            height: 40px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .custom-controls button:hover {
            background-color: #f0f0f0;
        }

        .custom-controls button:active {
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∏–Ω–∏–π –∫—Ä—É–≥ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è */
        .user-location {
            width: 12px;
            height: 12px;
            background-color: #007AFF;
            border: 2px solid white;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 122, 255, 0.7);
        }

        nav {
            display: flex;
            justify-content: space-around;
            background-color: #d3d3d3;
            padding: 15px;
            border-radius: 15px;
            margin: 20px;
        }

        nav a {
            padding: 10px 20px;
            text-decoration: none;
            color: black;
            border-radius: 10px;
            transition: background-color 0.3s;
        }

        nav a.active {
            background-color: #a9a9a9;
            border-radius: 10px;
        }

        nav a:hover {
            background-color: #c0c0c0;
        }
    </style>
</head>
<body>
    <nav>
        <a href="/" class="{{ 'active' if request.path == '/' else '' }}">–ì–æ–ª–æ–≤–Ω–∞</a>
        <a href="/add_place" class="{{ 'active' if request.path == '/add_place' else '' }}">–î–æ–¥–∞—Ç–∏</a>
        <a href="/review" class="{{ 'active' if request.path == '/review' else '' }}">–ù–∞–ø–∏—Å–∞—Ç–∏ –≤—ñ–¥–≥—É–∫</a>
        <a href="/login" class="{{ 'active' if request.path == '/login' else '' }}">–£–≤—ñ–π—Ç–∏</a>
        <a href="/signup" class="{{ 'active' if request.path == '/signup' else '' }}">–ó–∞—Ä–µ–µ—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</a>
        <a href="/about_us" class="{{ 'active' if request.path == '/about_us' else '' }}">–ü—Ä–æ –Ω–∞—Å</a>
        <a href="/partners" class="{{ 'active' if request.path == '/partners' else '' }}">–ü–∞—Ä—Ç–Ω–µ—Ä–∏</a>
    </nav>
    <div id="map"></div>

    <div class="custom-controls">
        <button id="zoom-in">+</button>
        <button id="zoom-out">‚àí</button>
        <button id="locate-btn">üîò</button>
    </div>

    <div class="flash-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script>
        var map = L.map('map', {
            zoomControl: false
        }).setView([49.9935, 36.2304], 12);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // –ü—É—Ç—å –∫ –∏–∫–æ–Ω–∫–µ —á–∞—à–∫–∏ –∫–æ—Ñ–µ
        var coffeeIcon = L.icon({
            iconUrl: '/static/coffee-cup.png',  // –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –≤–∞—à–µ–º—É –∑–Ω–∞—á–∫—É
            iconSize: [32, 32],  // –†–∞–∑–º–µ—Ä –∑–Ω–∞—á–∫–∞
            iconAnchor: [16, 32],  // –¶–µ–Ω—Ç—Ä –∑–Ω–∞—á–∫–∞
            popupAnchor: [0, -32]  // –ü–æ–∑–∏—Ü–∏—è –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –æ–∫–Ω–∞
        });

        {% for cafe in cafes %}
            {% if cafe.latitude and cafe.longitude %}
                L.marker([{{ cafe.latitude }}, {{ cafe.longitude }}], { icon: coffeeIcon })
                    .addTo(map)
                    .bindPopup("<b>{{ cafe.name }}</b><br>{{ cafe.address }}<br>–†–µ–π—Ç–∏–Ω–≥: {{ cafe.rating }}");
            {% else %}
                console.log('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–ª—è –∫–∞—Ñ–µ: {{ cafe.name }}');
            {% endif %}
        {% endfor %}

        // –ú—ñ—Å—Ü–µ–ø–æ–ª–æ–∂–µ–Ω–Ω—è
        var userMarker;

        function locateUser() {
            if (!navigator.geolocation) {
                alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—é.');
                return;
            }

            navigator.geolocation.getCurrentPosition(function(position) {
                var lat = position.coords.latitude;
                var lon = position.coords.longitude;

                if (userMarker) {
                    map.removeLayer(userMarker);
                }

                userMarker = L.marker([lat, lon], {
                    icon: L.divIcon({
                        className: 'user-location'
                    })
                }).addTo(map);

                map.setView([lat, lon], 15);
            }, function(error) {
                alert('–ù–µ –≤–¥–∞–ª–æ—Å—å –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –º—ñ—Å—Ü–µ –ø–æ–ª–æ–∂–µ–Ω–Ω—è: ' + error.message);
            });
        }

        // –ö–Ω–æ–ø–∫–∏ –º–∞—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
        document.getElementById('zoom-in').addEventListener('click', function() {
            map.zoomIn();
        });

        document.getElementById('zoom-out').addEventListener('click', function() {
            map.zoomOut();
        });

        // –ö–Ω–æ–ø–∫–∞ –º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è
        document.getElementById('locate-btn').addEventListener('click', locateUser);

        locateUser();
    </script>

</body>
</html>
